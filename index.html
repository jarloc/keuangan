<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KEUANGAN PRIBADI</title>

<!-- ===== FIREBASE (SCRIPT TAG / COMPAT) ===== -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCcBqGjq9ZN4Cv-pDfNqaJ2QxnqSqzzPHE",
    authDomain: "keuangan-3ae83.firebaseapp.com",
    projectId: "keuangan-3ae83",
    storageBucket: "keuangan-3ae83.firebasestorage.app",
    messagingSenderId: "988326680959",
    appId: "1:988326680959:web:c2c39e4bed6cdf9c66a24a"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  /* ===== KUNCI MASALAH RELOAD (JANGAN DIHAPUS) ===== */
  auth.setPersistence(firebase.auth.Auth.Persistence.NONE);
</script>

<style>
:root{--gold:#d4af37;}
body,html{margin:0;height:100%;background:#000;color:#fff;font-family:Segoe UI}
button{cursor:pointer;border-radius:24px;border:1px solid var(--gold);background:transparent;color:var(--gold);padding:15px 250px}
button:hover{box-shadow:0 0 20px var(--gold)}
#welcome{height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center}
  #welcome h1{
  font-size:60px;
  margin: 10px 0;
}
#welcome input{margin:6px;width:600px;padding:10px;background:#111;color:#fff;border:1px solid var(--gold);border-radius:10px}
#welcome button{ margin-top:12px }
#main{display:none}
header{text-align:center;padding:20px;border-bottom:1px solid #333}
.card{margin:20px;padding:20px;border:1px solid #333;border-radius:16px}
.saldo{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px}
.box{padding:15px;border:1px solid #333;border-radius:12px}
.fab{position:fixed;right:20px;bottom:20px;width:60px;height:60px;border-radius:50%;background:var(--gold);color:#000;font-size:28px;padding: 0;border: none;box-shadow: 0 0 10px rgba(0,0,0,0.5);}
.modal{position:fixed;inset:0;display:none;background:rgba(0,0,0,.7);justify-content:center;align-items:center}
.modal-content{background:#000;padding:20px;border:1px solid var(--gold);border-radius:16px;width:300px}
input,select{width:100%;margin-top:8px;padding:8px;background:#111;color:#fff;border:1px solid #333;border-radius:8px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #333}
@media (max-width: 768px) {

  #welcome h1:first-of-type {
    font-size: 20px !important; /* "SELAMAT DATANG DI WEBSITE" */
  }

  #welcome h1:last-of-type {
    font-size: 35px !important; /* "KEUANGAN PRIBADI" */
  }

  #welcome p {
    font-size: 11px;
    padding: 0 20px;
    text-align: center;
  }
  #welcome input, #welcome button {
    width: 85%;
    padding: 12px;
  }

  #welcome button{
    width:90%;
    padding:15px 0;
  }

}

</style>
</head>
<body>

<!-- ===== WELCOME SCREEN ===== -->
<div id="welcome">
  <h1 style="color:var(--gold); font-size:35px;">SELAMAT DATANG DI WEBSITE</h1>
  <h1 style="color:var(--gold); font-size:75px;">KEUANGAN PRIBADI</h1>
  <p>Built and developed by Fajar Ilmanosa Viar . <b>V1.3.4</b> for personal use only. Copyright Â© 2026 . All Rights Reserved</p>
  <input id="email" placeholder="Email Admin">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">LOGIN</button>
</div>

<!-- ===== MAIN APP ===== -->
<div id="main">
<header>
<h2 style="color:var(--gold)">KEUANGAN PRIBADI</h2>
<select id="bulan"></select>
<select id="tahun"></select>
</header>

<div class="card saldo">
  <div class="box">ATM<br><strong id="atm">0</strong></div>
  <div class="box">CASH<br><strong id="cash">0</strong></div>
  <div class="box">TOTAL<br><strong id="total">0</strong></div>
</div>

<div class="card">
  <div style="margin-bottom: 15px; display: flex; gap: 10px;">
    <button id="btnModeEdit" onclick="toggleMode('edit')" style="width:auto; padding:8px 15px; font-size:12px;">EDIT</button>
    <button id="btnModeHapus" onclick="toggleMode('hapus')" style="width:auto; padding:8px 15px; font-size:12px;">HAPUS</button>
  </div>
  <table>
<thead><tr><th>Tgl</th><th>Ket</th><th>Metode</th><th>Nominal</th><th></th></tr></thead>
<tbody id="list"></tbody>
</table>
</div>

<button class="fab" onclick="openForm()">+</button>
</div>

<!-- ===== MODAL ===== -->
<div class="modal" id="modal">
<div class="modal-content">
<input id="tglInput" type="date">
<select id="jenis">
  <option value="masuk">Pemasukan</option>
  <option value="keluar">Pengeluaran</option>
</select>
<select id="metode">
  <option value="atm">ATM</option>
  <option value="cash">Cash</option>
</select>
<input id="ket" placeholder="Keterangan">
<input id="nominal" type="number" placeholder="Nominal">
<button onclick="simpan()">Simpan</button>
<button onclick="closeForm()">Tutup</button>
</div>
</div>

<script>
// Inisialisasi Firestore
const db = firebase.firestore();

let atm = 0, cash = 0, data = [], periode = {};
const bulanEl = document.getElementById("bulan"), tahunEl = document.getElementById("tahun");
const bulanNama = ["JANUARI","FEBRUARI","MAARET","APRIL","MEI","JUNI","JULI","AGUSTUS","SEPTEMBER","OKTOBER","NOVEMBER","DESEMBER"];

// Setting Dropdown & Periode
bulanNama.forEach((b, i) => bulanEl.innerHTML += `<option value="${i + 1}">${b}</option>`);
for (let y = 2020; y <= 2035; y++) tahunEl.innerHTML += `<option>${y}</option>`;

periode.bulan = new Date().getMonth() + 1;
periode.tahun = new Date().getFullYear();
bulanEl.value = periode.bulan;
tahunEl.value = periode.tahun;

function key() { return `${periode.tahun}_${periode.bulan}`; }

// Fungsi Ambil Data dari Firebase (Cloud)
async function load() {
    const user = auth.currentUser;
    if (!user) return;

    document.getElementById("list").innerHTML = "<tr><td colspan='4' style='text-align:center'>Memuat data...</td></tr>";

    try {
        const docRef = db.collection("keuangan").doc(`${user.uid}_${key()}`);
        const doc = await docRef.get();

        if (doc.exists) {
            const cloudData = doc.data();
            atm = cloudData.atm || 0;
            cash = cloudData.cash || 0;
            data = cloudData.transaksi || [];
        } else {
            atm = 0; cash = 0; data = [];
        }
        render();
    } catch (e) {
        console.error("Error loading:", e);
    }
}

// Fungsi Simpan Data ke Firebase (Cloud)
async function save() {
    const user = auth.currentUser;
    if (!user) return;
    try {
        await db.collection("keuangan").doc(`${user.uid}_${key()}`).set({
            atm: atm,
            cash: cash,
            transaksi: data,
            lastUpdate: firebase.firestore.FieldValue.serverTimestamp()
        });
    } catch (e) {
        alert("Gagal simpan ke Cloud: " + e.message);
    }
}

// Fungsi Tampilan (Render)
function f(n) { return new Intl.NumberFormat('id-ID').format(n); }

function render() {
    document.getElementById("atm").textContent = f(atm);
    document.getElementById("cash").textContent = f(cash);
    document.getElementById("total").textContent = f(atm + cash);
    
    document.getElementById("list").innerHTML = data.map((d, i) => `
        <tr>
            <td>${d.tgl}</td>
            <td>${d.ket}</td>
            <td>${d.metode.toUpperCase()}</td>
            <td style="color:${d.jenis === 'masuk' ? '#00ff00' : '#ff4444'}">
                ${d.jenis === 'masuk' ? '+' : '-'}${f(d.nominal)}
            </td>
            <td>
                ${modeHapus ? `<button style="padding:5px 10px; width:auto; font-size:10px; background:red; color:white; border:none; border-radius:4px;" onclick="hapusData(${i})">X</button>` : ''}
                ${modeEdit ? `<button style="padding:5px 10px; width:auto; font-size:10px; background:blue; color:white; border:none; border-radius:4px;" onclick="bukaEdit(${i})">Edit</button>` : ''}
            </td>
        </tr>
    `).join("");
}

// Event Handlers
bulanEl.onchange = tahunEl.onchange = () => {
    periode.bulan = bulanEl.value;
    periode.tahun = tahunEl.value;
    load();
};

// Fungsi buat munculin dan menutup kotak input (modal)
function openForm() { 
  document.getElementById("modal").style.display = "flex";
  // Baris ini buat ngisi tanggal otomatis hari ini
  document.getElementById("tglInput").valueAsDate = new Date();
}
function closeForm() { document.getElementById("modal").style.display = "none"; }

async function hapusData(index) {
    if (!confirm("Yakin mau hapus data ini?")) return;

    const item = data[index];
    
    // 1. Balikin saldonya dulu sebelum dihapus
    if (item.jenis === "masuk") {
        item.metode === "atm" ? atm -= item.nominal : cash -= item.nominal;
    } else {
        item.metode === "atm" ? atm += item.nominal : cash += item.nominal;
    }

    // 2. Buang dari list (array)
    data.splice(index, 1);

    // 3. Update tampilan dan simpan ke Cloud
    render();
    await save();
}
// 1. Tambahkan variabel status di bagian atas script
let modeEdit = false;
let modeHapus = false;
let editIndex = null; // Penting: Buat nandaian baris mana yang lagi di edit

// 2. Fungsi buat mati-nyalain mode
function toggleMode(tipe) {
    if (tipe === 'edit') {
        modeEdit = !modeEdit; // Kalo tadi mati jadi nyala, kalo nyala jadi mati
        modeHapus = false;    // Matiin mode hapus biar gak bentrok
    } else if (tipe === 'hapus') {
        modeHapus = !modeHapus;
        modeEdit = false;     // Matiin mode edit biar gak bentrok
    }
    
    // 3. Update Visual Tombol (Biar tau mana yang lagi aktif)
    const btnEdit = document.getElementById("btnModeEdit");
    const btnHapus = document.getElementById("btnModeHapus");

    // Efek buat tombol EDIT
    btnEdit.textContent = modeEdit ? "SELESAI" : "EDIT";
    btnEdit.style.background = modeEdit ? "blue" : "transparent";
    btnEdit.style.color = modeEdit ? "white" : "blue";

    // Efek buat tombol HAPUS
    btnHapus.textContent = modeHapus ? "SELESAI" : "HAPUS";
    btnHapus.style.background = modeHapus ? "red" : "transparent";
    btnHapus.style.color = modeHapus ? "white" : "red";

    // 4. Gambar ulang tabelnya (biar tombol di tiap baris muncul/hilang)
    render();
}
async function simpan() {
    const tglPilihan = document.getElementById("tglInput").value;
    const j = document.getElementById("jenis").value;
    const m = document.getElementById("metode").value;
    const n = +document.getElementById("nominal").value;
    const k = document.getElementById("ket").value;

    if (!n || !k || !tglPilihan) return alert("Isi semua data!");

    
    const d = new Date(tglPilihan);
    const tglTabel = `${d.getDate()}/${d.getMonth() + 1}`;

    if (j === "masuk") {
        m === "atm" ? atm += n : cash += n;
    } else {
        m === "atm" ? atm -= n : cash -= n;
    }

    data.unshift({
        tgl: tglTabel,
        ket: k,
        metode: m,
        jenis: j,
        nominal: n,
        tglAsli: tglPilihan
    });

    render();
    closeForm();
    await save();
    
    document.getElementById("nominal").value = "";
    document.getElementById("ket").value = "";
}

function login() {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, pass).catch(e => alert(e.message));
}

auth.onAuthStateChanged(user => {
    if (user) {
        document.getElementById("welcome").style.display = "none";
        document.getElementById("main").style.display = "block";
        load();
    } else {
        document.getElementById("welcome").style.display = "flex";
        document.getElementById("main").style.display = "none";
    }
});
</script>
  
<script>
window.addEventListener("beforeunload", function (e) {
  e.preventDefault();
  e.returnValue = "";
});
</script>

</body>
</html>









